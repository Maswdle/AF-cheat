(()=>{"use strict";var e,s={432(e,s,l){var t=l(848),a=l(540),n=l(338);const i=e=>{try{return new Date(e).toLocaleString("zh-CN")}catch{return e}},r=async e=>new Promise((s,l)=>{const t=new FileReader;t.onload=e=>{try{const t=e.target?.result,a=JSON.parse(t);a.metadata&&a.messages?s(a):Array.isArray(a)?s({messages:a}):l(new Error("æ— æ•ˆçš„JSONæ ¼å¼"))}catch(e){l(new Error(`æ–‡ä»¶è§£æžé”™è¯¯: ${e.message}`))}},t.onerror=()=>l(new Error("è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯")),t.readAsText(e)}),c=(0,a.memo)(({message:e,isSelf:s,style:l})=>{const a=s?"æˆ‘":e.nickname,n=s?"message-self":"message-other";return(0,t.jsxs)("div",{className:`message ${n}`,style:l,children:[(0,t.jsxs)("div",{className:"user-info",children:[(0,t.jsx)("div",{className:"avatar",children:a.charAt(0)}),(0,t.jsx)("div",{className:"message-sender",children:a})]}),(0,t.jsx)("div",{className:"message-bubble",children:e.content}),(0,t.jsx)("div",{className:"message-info",children:i(e.time)})]})});c.displayName="MessageItem";const d=c;var o=l(68);const h=({messages:e,currentUserId:s,perspectiveSwitched:l,height:n=600})=>{const i=(0,a.useCallback)(e=>{const t=e.id===s;return l?!t:t},[s,l]),r=(0,a.useCallback)(({index:s,style:l})=>{const a=e[s],n=i(a);return(0,t.jsx)(d,{message:a,isSelf:n,style:l})},[e,i]),c=(0,a.useCallback)(s=>e[s].Tid||s,[e]);return 0===e.length?(0,t.jsx)("div",{className:"empty-state",children:(0,t.jsx)("p",{children:"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¶ˆæ¯"})}):(0,t.jsx)("div",{className:"virtual-list-container",children:(0,t.jsx)(o.Y1,{height:n,itemCount:e.length,itemSize:100,width:"100%",itemKey:c,className:"message-list",children:r})})},m=({searchQuery:e,filter:s,perspectiveSwitched:l,onSearchChange:a,onFilterChange:n,onTogglePerspective:i})=>(0,t.jsxs)("div",{className:"search-container",children:[(0,t.jsx)("input",{type:"text",className:"search-input",placeholder:"æœç´¢æ¶ˆæ¯å†…å®¹...",value:e,onChange:e=>{a(e.target.value)}}),(0,t.jsxs)("div",{className:"filter-options",children:[(0,t.jsx)("button",{className:"filter-btn "+("all"===s?"active":""),onClick:()=>n("all"),children:"å…¨éƒ¨"}),(0,t.jsx)("button",{className:"filter-btn "+("self"===s?"active":""),onClick:()=>n("self"),children:"ä»…è‡ªå·±"}),(0,t.jsx)("button",{className:"filter-btn "+("other"===s?"active":""),onClick:()=>n("other"),children:"ä»…å¯¹æ–¹"}),(0,t.jsxs)("div",{className:"perspective-control",children:[(0,t.jsx)("span",{className:"perspective-label",children:"è§†è§’:"}),(0,t.jsx)("button",{className:"btn btn-outline",onClick:i,children:l?"å¯¹æ–¹è§†è§’":"è‡ªå·±è§†è§’"})]})]})]}),u=({files:e,folderName:s,selectedIndex:l,onSelectFile:a})=>0===e.length?(0,t.jsxs)("div",{className:"sidebar",children:[(0,t.jsx)("div",{className:"folder-info",children:"æœªé€‰æ‹©æ–‡ä»¶å¤¹"}),(0,t.jsx)("ul",{className:"file-list",children:(0,t.jsx)("li",{className:"empty-state",children:"è¯·é€‰æ‹©èŠå¤©è®°å½•æ–‡ä»¶å¤¹"})})]}):(0,t.jsxs)("div",{className:"sidebar",children:[(0,t.jsxs)("div",{className:"folder-info",children:["æ–‡ä»¶å¤¹: ",s," (",e.length," ä¸ªæ–‡ä»¶)"]}),(0,t.jsx)("ul",{className:"file-list",children:e.map((e,s)=>{return(0,t.jsxs)("li",{className:"file-item "+(l===s?"active":""),onClick:()=>a(s),children:[(0,t.jsx)("div",{className:"file-name",children:e.name}),(0,t.jsxs)("div",{className:"file-info",children:[(0,t.jsx)("span",{children:(n=e.size,n<1024?`${n} B`:n<1048576?`${(n/1024).toFixed(1)} KB`:`${(n/1048576).toFixed(1)} MB`)}),(0,t.jsx)("span",{children:new Date(e.lastModified).toLocaleDateString()})]})]},`${e.name}-${s}`);var n})})]}),x=({onFilesSelected:e,onSingleFileSelected:s,onShowHowTo:l})=>{const n=(0,a.useRef)(null),i=(0,a.useRef)(null);return(0,t.jsxs)("div",{className:"upload-section",children:[(0,t.jsx)("h2",{children:"åŠ è½½èŠå¤©è®°å½•"}),(0,t.jsx)("p",{className:"upload-hint",children:"é€‰æ‹©JSONæ ¼å¼çš„èŠå¤©è®°å½•æ–‡ä»¶"}),(0,t.jsxs)("div",{className:"upload-buttons",children:[(0,t.jsxs)("div",{className:"upload-option",children:[(0,t.jsx)("input",{ref:n,type:"file",className:"file-input-hidden",accept:".json",multiple:!0,webkitdirectory:"",onChange:s=>{s.target.files&&s.target.files.length>0&&e(s.target.files)}}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>n.current?.click(),children:"ðŸ“ é€‰æ‹©æ–‡ä»¶å¤¹"}),(0,t.jsx)("span",{className:"upload-label",children:"åŠ è½½æ•´ä¸ªæ–‡ä»¶å¤¹"})]}),(0,t.jsx)("div",{className:"upload-divider",children:(0,t.jsx)("span",{children:"æˆ–è€…"})}),(0,t.jsxs)("div",{className:"upload-option",children:[(0,t.jsx)("input",{ref:i,type:"file",className:"file-input-hidden",accept:".json",onChange:e=>{e.target.files&&e.target.files.length>0&&s(e.target.files[0])}}),(0,t.jsx)("button",{className:"btn btn-outline",onClick:()=>i.current?.click(),children:"ðŸ“„ é€‰æ‹©å•ä¸ªæ–‡ä»¶"}),(0,t.jsx)("span",{className:"upload-label",children:"åŠ è½½å•ä¸ªJSONæ–‡ä»¶"})]})]}),(0,t.jsx)("div",{className:"upload-help",children:(0,t.jsx)("button",{className:"btn btn-text",onClick:l,children:"â“ å¦‚ä½•èŽ·å–èŠå¤©è®°å½•"})})]})},j=({isOpen:e,onClose:s})=>e?(0,t.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h3",{children:"å¦‚ä½•èŽ·å–èŠå¤©è®°å½•"}),(0,t.jsx)("button",{className:"close-btn",onClick:s,children:"Ã—"})]}),(0,t.jsxs)("div",{className:"modal-body",children:[(0,t.jsxs)("ol",{className:"how-to-steps",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"èŽ·å–æ•°æ®æ–‡ä»¶"}),(0,t.jsx)("p",{children:"ä»Žç½‘ç«™å¯¼å‡ºèŠå¤©è®°å½•æ•°æ®ï¼Œé€šå¸¸ä¸ºJSONæ ¼å¼æ–‡ä»¶"})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"æ•´ç†æ–‡ä»¶"}),(0,t.jsx)("p",{children:"å°†æ‰€æœ‰JSONæ–‡ä»¶æ”¾å…¥åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­"})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"é€‰æ‹©æ–‡ä»¶å¤¹"}),(0,t.jsx)("p",{children:'ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶å¤¹"æŒ‰é’®ï¼Œé€‰æ‹©åŒ…å«JSONæ–‡ä»¶çš„æ–‡ä»¶å¤¹'})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"æŸ¥çœ‹è®°å½•"}),(0,t.jsx)("p",{children:"é€‰æ‹©å®ŒæˆåŽï¼Œå·¦ä¾§ä¼šæ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ï¼Œç‚¹å‡»å³å¯æŸ¥çœ‹èŠå¤©å†…å®¹"})]})]}),(0,t.jsxs)("div",{className:"tips",children:[(0,t.jsx)("h4",{children:"æç¤º"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"æ”¯æŒå¤šä¸ªJSONæ–‡ä»¶åŒæ—¶åŠ è½½"}),(0,t.jsx)("li",{children:"æ–‡ä»¶åä¼šæ˜¾ç¤ºåœ¨å·¦ä¾§åˆ—è¡¨ä¸­"}),(0,t.jsx)("li",{children:"å¯ä»¥ä½¿ç”¨æœç´¢åŠŸèƒ½æŸ¥æ‰¾ç‰¹å®šå†…å®¹"})]})]})]}),(0,t.jsx)("div",{className:"modal-footer",children:(0,t.jsx)("button",{className:"btn",onClick:s,children:"çŸ¥é“äº†"})})]})}):null,g=({chatData:e,currentUserId:s,filteredCount:l})=>{if(!e)return null;const a=((e,s)=>{const l=e.filter(e=>e.id===s),t=e.filter(e=>e.id!==s);return{total:e.length,selfCount:l.length,otherCount:t.length,timeRange:e.length>0?{start:e[0].time,end:e[e.length-1].time}:null}})(e.messages,s);return(0,t.jsxs)("div",{className:"stats-container",children:[(0,t.jsxs)("div",{className:"stats-row",children:[(0,t.jsxs)("span",{className:"stat-item",children:["æ€»æ¶ˆæ¯: ",(0,t.jsx)("strong",{children:a.total})]}),(0,t.jsxs)("span",{className:"stat-item",children:["æˆ‘å‘é€: ",(0,t.jsx)("strong",{children:a.selfCount})]}),(0,t.jsxs)("span",{className:"stat-item",children:["å¯¹æ–¹å‘é€: ",(0,t.jsx)("strong",{children:a.otherCount})]}),l!==a.total&&(0,t.jsxs)("span",{className:"stat-item filtered",children:["ç­›é€‰åŽ: ",(0,t.jsx)("strong",{children:l})]})]}),a.timeRange&&(0,t.jsxs)("div",{className:"time-range",children:["æ—¶é—´èŒƒå›´: ",a.timeRange.start," ~ ",a.timeRange.end]})]})},p=({message:e="åŠ è½½ä¸­..."})=>(0,t.jsxs)("div",{className:"loading-container",children:[(0,t.jsx)("div",{className:"loading-spinner"}),(0,t.jsx)("p",{className:"loading-message",children:e})]}),f=({message:e,onRetry:s})=>(0,t.jsxs)("div",{className:"error-container",children:[(0,t.jsx)("div",{className:"error-icon",children:"âš ï¸"}),(0,t.jsx)("p",{className:"error-message",children:e}),s&&(0,t.jsx)("button",{className:"btn btn-outline",onClick:s,children:"é‡è¯•"})]}),N=({users:e,currentUserId:s,onSelectUser:l})=>e.length<=1?null:(0,t.jsxs)("div",{className:"user-selector",children:[(0,t.jsx)("span",{className:"user-selector-label",children:'é€‰æ‹©"æˆ‘"çš„èº«ä»½:'}),(0,t.jsx)("div",{className:"user-buttons",children:e.map(e=>(0,t.jsxs)("button",{className:"user-btn "+(s===e.id?"active":""),onClick:()=>l(e.id),title:`ID: ${e.id.substring(0,8)}...`,children:[e.nickname||"æœªçŸ¥ç”¨æˆ·",(0,t.jsxs)("span",{className:"message-count",children:["(",e.count,"æ¡)"]})]},e.id))})]});n.createRoot(document.getElementById("root")).render((0,t.jsx)(a.StrictMode,{children:(0,t.jsx)(()=>{const[e,s]=(0,a.useState)(!1),[l,n]=(0,a.useState)(600),{files:i,folderName:c,selectedIndex:d,isLoading:o,error:v,handleFilesSelected:b,handleSingleFileSelected:S,selectFile:C,clearFiles:y}=(()=>{const[e,s]=(0,a.useState)([]),[l,t]=(0,a.useState)(""),[n,i]=(0,a.useState)(-1),[c,d]=(0,a.useState)(!1),[o,h]=(0,a.useState)(null),m=(0,a.useCallback)(async e=>{const l=Array.from(e).filter(e=>e.name.toLowerCase().endsWith(".json"));if(0!==l.length){d(!0),h(null);try{const a=e[0].webkitRelativePath.split("/")[0];t(a);const n=[];for(const e of l)try{const s=await r(e);n.push({name:e.name,size:e.size,lastModified:e.lastModified,content:s})}catch(s){console.error(`Failed to parse ${e.name}:`,s)}s(n),n.length>0&&i(0)}catch(e){h(e.message)}finally{d(!1)}}else h("æœªæ‰¾åˆ°JSONæ–‡ä»¶")},[]),u=(0,a.useCallback)(async e=>{if(e.name.toLowerCase().endsWith(".json")){d(!0),h(null);try{const l=await r(e),a={name:e.name,size:e.size,lastModified:e.lastModified,content:l};s([a]),t(""),i(0)}catch(e){h(e.message)}finally{d(!1)}}else h("è¯·é€‰æ‹©JSONæ–‡ä»¶")},[]),x=(0,a.useCallback)(s=>{s>=0&&s<e.length&&i(s)},[e.length]),j=(0,a.useCallback)(()=>{s([]),t(""),i(-1),h(null)},[]);return{files:e,folderName:l,selectedIndex:n,isLoading:c,error:o,handleFilesSelected:m,handleSingleFileSelected:u,selectFile:x,clearFiles:j}})(),{chatData:w,currentUserId:k,users:F,searchQuery:O,filter:I,perspectiveSwitched:M,isLoading:L,error:U,filteredMessages:E,setChatData:R,setCurrentUserId:D,setSearchQuery:J,setFilter:z,togglePerspective:P,reset:$}=(()=>{const[e,s]=(0,a.useState)(null),[l,t]=(0,a.useState)(""),[n,i]=(0,a.useState)(""),[r,c]=(0,a.useState)("all"),[d,o]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),u=(0,a.useMemo)(()=>e?(e=>{const s=new Map;return e.forEach(e=>{const l=s.get(e.id);l?l.count++:s.set(e.id,{nickname:e.nickname,count:1})}),Array.from(s.entries()).map(([e,s])=>({id:e,nickname:s.nickname,count:s.count}))})(e.messages):[],[e]),x=(0,a.useMemo)(()=>e?((e,s,l,t)=>e.filter(e=>!("self"===l&&e.id!==s||"other"===l&&e.id===s||t&&!e.content.toLowerCase().includes(t.toLowerCase()))))(e.messages,l,r,n):[],[e,l,r,n]),j=(0,a.useCallback)(e=>{if(s(e),e){const s=(e=>e.metadata?.my_user_id?e.metadata.my_user_id:0===e.messages.length?"":e.messages[0].id)(e);t(s)}else t("");i(""),c("all"),o(!1),m(null)},[]),g=(0,a.useCallback)(()=>{o(e=>!e)},[]),p=(0,a.useCallback)(()=>{s(null),t(""),i(""),c("all"),o(!1),m(null)},[]);return{chatData:e,currentUserId:l,users:u,searchQuery:n,filter:r,perspectiveSwitched:d,isLoading:!1,error:h,filteredMessages:x,setChatData:j,setCurrentUserId:t,setSearchQuery:i,setFilter:c,togglePerspective:g,setError:m,reset:p}})();(0,a.useEffect)(()=>{d>=0&&i[d]&&R(i[d].content)},[d,i,R]),(0,a.useEffect)(()=>{const e=()=>{const e=window.innerHeight-200;n(Math.max(400,e))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const A=(0,a.useCallback)(()=>{y(),$()},[y,$]),Q=o||L,T=v||U;return(0,t.jsxs)("div",{className:"app",children:[(0,t.jsxs)("header",{className:"app-header",children:[(0,t.jsx)("h1",{className:"app-title",children:"èŠå¤©è®°å½•æŸ¥çœ‹å™¨"}),(0,t.jsx)("div",{className:"header-actions",children:i.length>0&&(0,t.jsx)("button",{className:"btn btn-outline",onClick:A,children:"æ¸…é™¤æ–‡ä»¶"})})]}),(0,t.jsx)("main",{className:"app-main",children:0===i.length?(0,t.jsx)("div",{className:"welcome-container",children:(0,t.jsx)(x,{onFilesSelected:b,onSingleFileSelected:S,onShowHowTo:()=>s(!0)})}):(0,t.jsxs)("div",{className:"content-container",children:[(0,t.jsx)(u,{files:i,folderName:c,selectedIndex:d,onSelectFile:C}),(0,t.jsxs)("div",{className:"chat-container",children:[Q&&(0,t.jsx)(p,{message:"åŠ è½½ä¸­..."}),T&&(0,t.jsx)(f,{message:T,onRetry:()=>C(d)}),!Q&&!T&&w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(N,{users:F,currentUserId:k,onSelectUser:D}),(0,t.jsx)(m,{searchQuery:O,filter:I,perspectiveSwitched:M,onSearchChange:J,onFilterChange:z,onTogglePerspective:P}),(0,t.jsx)(g,{chatData:w,currentUserId:k,filteredCount:E.length}),(0,t.jsx)("div",{className:"messages-wrapper",children:(0,t.jsx)(h,{messages:E,currentUserId:k,perspectiveSwitched:M,height:l})})]})]})]})}),(0,t.jsx)(j,{isOpen:e,onClose:()=>s(!1)})]})},{})}))}},l={};function t(e){var a=l[e];if(void 0!==a)return a.exports;var n=l[e]={exports:{}};return s[e](n,n.exports,t),n.exports}t.m=s,e=[],t.O=(s,l,a,n)=>{if(!l){var i=1/0;for(o=0;o<e.length;o++){for(var[l,a,n]=e[o],r=!0,c=0;c<l.length;c++)(!1&n||i>=n)&&Object.keys(t.O).every(e=>t.O[e](l[c]))?l.splice(c--,1):(r=!1,n<i&&(i=n));if(r){e.splice(o--,1);var d=a();void 0!==d&&(s=d)}}return s}n=n||0;for(var o=e.length;o>0&&e[o-1][2]>n;o--)e[o]=e[o-1];e[o]=[l,a,n]},t.d=(e,s)=>{for(var l in s)t.o(s,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:s[l]})},t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),(()=>{var e={792:0};t.O.j=s=>0===e[s];var s=(s,l)=>{var a,n,[i,r,c]=l,d=0;if(i.some(s=>0!==e[s])){for(a in r)t.o(r,a)&&(t.m[a]=r[a]);if(c)var o=c(t)}for(s&&s(l);d<i.length;d++)n=i[d],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(o)},l=self.webpackChunkchat_viewer=self.webpackChunkchat_viewer||[];l.forEach(s.bind(null,0)),l.push=s.bind(null,l.push.bind(l))})();var a=t.O(void 0,[96],()=>t(432));a=t.O(a)})();